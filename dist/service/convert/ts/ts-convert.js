"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TsConvert = void 0;
const ts_1 = __importDefault(require("src/module/ts"));
const ts_parser_file_1 = require("src/service/convert/ts/parser/ts-parser-file");
const ts_config_file_service_1 = require("src/service/convert/ts/ts-config-file-service");
const ts_entity_parser_1 = require("src/service/convert/ts/ts-entity-parser");
const ts_parser_service_1 = require("src/service/convert/ts/ts-parser-service");
const file_service_1 = require("src/service/file-service");
class TsConvert {
    constructor({ filePath, folderPath }) {
        this._filePath = filePath;
        this._folderPath = folderPath;
    }
    async convert() {
        await ts_config_file_service_1.tsConfigFileService.init();
        const fileName = file_service_1.fileService.fileNameFromPath(this._filePath, { withExtension: true });
        const parsedSource = await this._parseFile({ filePath: this._filePath, fileName });
        const hasExportsInFile = ts_parser_service_1.tsParserService.checkIfThereAreAnyExports(parsedSource);
        const inProjectPath = file_service_1.fileService.cleanupPath(this._filePath);
        if (!hasExportsInFile)
            return new ts_parser_file_1.TsParserFile({ parsedSource, fileName, inProjectPath }).parse();
        const entityParser = new ts_entity_parser_1.TsEntityParser({ parsedSource, fileName, inProjectPath });
        return entityParser.parsedEntities();
    }
    /**
     * https://allenhwkim.medium.com/how-to-parse-typescript-from-source-643387971f4e
     *
     * https://ts-ast-viewer.com/#code/JYWwDg9gTgLgBAbzgYQuCA7Aph+BfOAMyjTgHIABAQwwHMBXAGyqgHoBjaLMgbgCgKqdNlwAKBHzhwAzlkZZ2MaAC5yIAJ5kANJLgws4ZvtVkAFnMYQ4ILADoyfPAEo+WAB6RYcds2nS4ALLqQpAi8BJ4QA
     */
    async _parseFile(params) {
        const { filePath, fileName } = params;
        const fileSource = await file_service_1.fileService.readFile(filePath);
        return ts_1.default.createSourceFile(fileName, fileSource, ts_1.default.ScriptTarget.ES2020); // TODO implement param for script target
    }
}
exports.TsConvert = TsConvert;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHMtY29udmVydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zZXJ2aWNlL2NvbnZlcnQvdHMvdHMtY29udmVydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSx1REFBOEI7QUFFOUIsaUZBQTJFO0FBQzNFLDBGQUFtRjtBQUNuRiw4RUFBd0U7QUFDeEUsZ0ZBQTBFO0FBQzFFLDJEQUFzRDtBQUV0RCxNQUFhLFNBQVM7SUFJcEIsWUFBWSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQTRDO1FBQzVFLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFBO1FBQ3pCLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFBO0lBQy9CLENBQUM7SUFFTSxLQUFLLENBQUMsT0FBTztRQUNsQixNQUFNLDRDQUFtQixDQUFDLElBQUksRUFBRSxDQUFBO1FBQ2hDLE1BQU0sUUFBUSxHQUFHLDBCQUFXLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQ3RGLE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUE7UUFFbEYsTUFBTSxnQkFBZ0IsR0FBRyxtQ0FBZSxDQUFDLHlCQUF5QixDQUFDLFlBQVksQ0FBQyxDQUFBO1FBQ2hGLE1BQU0sYUFBYSxHQUFHLDBCQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUM3RCxJQUFJLENBQUMsZ0JBQWdCO1lBQUUsT0FBTyxJQUFJLDZCQUFZLENBQUMsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUE7UUFFakcsTUFBTSxZQUFZLEdBQUcsSUFBSSxpQ0FBYyxDQUFDLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFBO1FBQ2xGLE9BQU8sWUFBWSxDQUFDLGNBQWMsRUFBRSxDQUFBO0lBQ3RDLENBQUM7SUFFRDs7OztPQUlHO0lBQ08sS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUE4QztRQUN2RSxNQUFNLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxHQUFHLE1BQU0sQ0FBQTtRQUNyQyxNQUFNLFVBQVUsR0FBRyxNQUFNLDBCQUFXLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ3ZELE9BQU8sWUFBRSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsWUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQSxDQUFDLHlDQUF5QztJQUNwSCxDQUFDO0NBQ0Y7QUFoQ0QsOEJBZ0NDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnc3JjL21vZGVsL2VudGl0eSdcbmltcG9ydCB0cyBmcm9tICdzcmMvbW9kdWxlL3RzJ1xuaW1wb3J0IHsgQ29udmVydFN0cmF0ZWd5IH0gZnJvbSAnc3JjL3NlcnZpY2UvY29udmVydC9jb252ZXJ0LXN0cmF0ZWd5J1xuaW1wb3J0IHsgVHNQYXJzZXJGaWxlIH0gZnJvbSAnc3JjL3NlcnZpY2UvY29udmVydC90cy9wYXJzZXIvdHMtcGFyc2VyLWZpbGUnXG5pbXBvcnQgeyB0c0NvbmZpZ0ZpbGVTZXJ2aWNlIH0gZnJvbSAnc3JjL3NlcnZpY2UvY29udmVydC90cy90cy1jb25maWctZmlsZS1zZXJ2aWNlJ1xuaW1wb3J0IHsgVHNFbnRpdHlQYXJzZXIgfSBmcm9tICdzcmMvc2VydmljZS9jb252ZXJ0L3RzL3RzLWVudGl0eS1wYXJzZXInXG5pbXBvcnQgeyB0c1BhcnNlclNlcnZpY2UgfSBmcm9tICdzcmMvc2VydmljZS9jb252ZXJ0L3RzL3RzLXBhcnNlci1zZXJ2aWNlJ1xuaW1wb3J0IHsgZmlsZVNlcnZpY2UgfSBmcm9tICdzcmMvc2VydmljZS9maWxlLXNlcnZpY2UnXG5cbmV4cG9ydCBjbGFzcyBUc0NvbnZlcnQgaW1wbGVtZW50cyBDb252ZXJ0U3RyYXRlZ3kge1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgX2ZpbGVQYXRoOiBzdHJpbmdcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IF9mb2xkZXJQYXRoOiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcih7IGZpbGVQYXRoLCBmb2xkZXJQYXRoIH06IHsgZmlsZVBhdGg6IHN0cmluZzsgZm9sZGVyUGF0aDogc3RyaW5nIH0pIHtcbiAgICB0aGlzLl9maWxlUGF0aCA9IGZpbGVQYXRoXG4gICAgdGhpcy5fZm9sZGVyUGF0aCA9IGZvbGRlclBhdGhcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBjb252ZXJ0KCk6IFByb21pc2U8RW50aXR5W10+IHtcbiAgICBhd2FpdCB0c0NvbmZpZ0ZpbGVTZXJ2aWNlLmluaXQoKVxuICAgIGNvbnN0IGZpbGVOYW1lID0gZmlsZVNlcnZpY2UuZmlsZU5hbWVGcm9tUGF0aCh0aGlzLl9maWxlUGF0aCwgeyB3aXRoRXh0ZW5zaW9uOiB0cnVlIH0pXG4gICAgY29uc3QgcGFyc2VkU291cmNlID0gYXdhaXQgdGhpcy5fcGFyc2VGaWxlKHsgZmlsZVBhdGg6IHRoaXMuX2ZpbGVQYXRoLCBmaWxlTmFtZSB9KVxuXG4gICAgY29uc3QgaGFzRXhwb3J0c0luRmlsZSA9IHRzUGFyc2VyU2VydmljZS5jaGVja0lmVGhlcmVBcmVBbnlFeHBvcnRzKHBhcnNlZFNvdXJjZSlcbiAgICBjb25zdCBpblByb2plY3RQYXRoID0gZmlsZVNlcnZpY2UuY2xlYW51cFBhdGgodGhpcy5fZmlsZVBhdGgpXG4gICAgaWYgKCFoYXNFeHBvcnRzSW5GaWxlKSByZXR1cm4gbmV3IFRzUGFyc2VyRmlsZSh7IHBhcnNlZFNvdXJjZSwgZmlsZU5hbWUsIGluUHJvamVjdFBhdGggfSkucGFyc2UoKVxuXG4gICAgY29uc3QgZW50aXR5UGFyc2VyID0gbmV3IFRzRW50aXR5UGFyc2VyKHsgcGFyc2VkU291cmNlLCBmaWxlTmFtZSwgaW5Qcm9qZWN0UGF0aCB9KVxuICAgIHJldHVybiBlbnRpdHlQYXJzZXIucGFyc2VkRW50aXRpZXMoKVxuICB9XG5cbiAgLyoqXG4gICAqIGh0dHBzOi8vYWxsZW5od2tpbS5tZWRpdW0uY29tL2hvdy10by1wYXJzZS10eXBlc2NyaXB0LWZyb20tc291cmNlLTY0MzM4Nzk3MWY0ZVxuICAgKlxuICAgKiBodHRwczovL3RzLWFzdC12aWV3ZXIuY29tLyNjb2RlL0pZV3dEZzlnVGdMZ0JBYnpnWVF1Q0E3QXBoK0JmT0FNeWpUZ0hJQUJBUXd3SE1CWEFHeXFnSG9CamFMTWdiZ0NnS3FkTmx3QUtCSHpod0F6bGtaWjJNYUFDNXlJQUo1a0FOSkxnd3M0WnZ0VmtBRm5NWVE0SUxBRG95ZlBBRW8rV0FCNlJZY2RzMm5TNEFMTHFRcEFpOEJKNFFBXG4gICAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgX3BhcnNlRmlsZShwYXJhbXM6IHsgZmlsZVBhdGg6IHN0cmluZzsgZmlsZU5hbWU6IHN0cmluZyB9KTogUHJvbWlzZTx0cy5Tb3VyY2VGaWxlPiB7XG4gICAgY29uc3QgeyBmaWxlUGF0aCwgZmlsZU5hbWUgfSA9IHBhcmFtc1xuICAgIGNvbnN0IGZpbGVTb3VyY2UgPSBhd2FpdCBmaWxlU2VydmljZS5yZWFkRmlsZShmaWxlUGF0aClcbiAgICByZXR1cm4gdHMuY3JlYXRlU291cmNlRmlsZShmaWxlTmFtZSwgZmlsZVNvdXJjZSwgdHMuU2NyaXB0VGFyZ2V0LkVTMjAyMCkgLy8gVE9ETyBpbXBsZW1lbnQgcGFyYW0gZm9yIHNjcmlwdCB0YXJnZXRcbiAgfVxufVxuIl19