"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.fileService = void 0;
const fs_1 = require("fs");
const glob_1 = __importDefault(require("glob"));
const path_1 = __importDefault(require("path"));
const constant_1 = require("src/util/constant");
exports.fileService = {
    fileListFromFolder: async ({ folderPath }) => {
        return new Promise((resolve, reject) => {
            const cwd = exports.fileService.relativeToAbsPath(folderPath);
            glob_1.default('**/*', { cwd, dot: true, nodir: true, ignore: '*.test.ts' }, (err, files) => {
                if (err)
                    return reject(err);
                return resolve(files);
            });
        });
    },
    makeFolderIfNotExist: async ({ folderPath }) => {
        if (await fs_1.promises.stat(folderPath).catch(() => false))
            return;
        await fs_1.promises.mkdir(folderPath);
    },
    writeToFile: async ({ filePath, data }) => {
        await fs_1.promises.writeFile(filePath, data, 'utf-8');
    },
    readFile: async (filePath) => {
        return fs_1.promises.readFile(filePath, 'utf8');
    },
    mkdirAndWriteToFile: async ({ folderPath, fileName, data, }) => {
        await exports.fileService.makeFolderIfNotExist({ folderPath });
        await exports.fileService.writeToFile({ filePath: exports.fileService.joinPaths(folderPath, fileName), data });
    },
    joinPaths: (...paths) => {
        return path_1.default.join(...paths);
    },
    isAbsPath: (relativeOrAbsPath) => {
        return relativeOrAbsPath.startsWith(constant_1.constant.folderSep);
    },
    relativeToAbsPath: (relativeOrAbsPath) => {
        return exports.fileService.isAbsPath(relativeOrAbsPath) ? relativeOrAbsPath : exports.fileService.joinPaths(process.cwd(), relativeOrAbsPath);
    },
    cleanupPath: (relativeOrAbsPath) => {
        return path_1.default.join(relativeOrAbsPath);
        // return relativeOrAbsPath.startsWith('./') ? relativeOrAbsPath.slice(2) : relativeOrAbsPath
    },
    lastFolderFromPath: (filePath) => {
        const pathSplit = filePath.split(constant_1.constant.folderSep);
        if (pathSplit[pathSplit.length - 1].includes('.'))
            pathSplit.pop();
        return pathSplit.join(constant_1.constant.folderSep);
    },
    importPathFind: (filePathImportedFrom, importPath) => {
        const importedFromPath = exports.fileService.lastFolderFromPath(filePathImportedFrom);
        const importPathSplit = importPath.split(constant_1.constant.folderSep);
        const importedFromPathReverseSplit = importedFromPath.split(constant_1.constant.folderSep).reverse();
        let equalPathSplitCount = 0;
        for (const [ix, split] of Object.entries(importPathSplit)) {
            if (importedFromPathReverseSplit[ix] !== split)
                break;
            equalPathSplitCount = +ix + 1;
        }
        const cleanImportPath = importPathSplit.slice(equalPathSplitCount).join(constant_1.constant.folderSep);
        return exports.fileService.joinPaths(importedFromPath, cleanImportPath);
    },
    fileNameFromPath: (filePath, options = {}) => {
        const parts = filePath.split(constant_1.constant.folderSep);
        const lastPart = parts[parts.length - 1];
        if (options.withExtension)
            return lastPart;
        const nameParts = lastPart.split('.');
        if (nameParts.length === 1)
            return nameParts[0];
        nameParts.pop();
        return nameParts.join('.');
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2UvZmlsZS1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDJCQUFtQztBQUNuQyxnREFBdUI7QUFDdkIsZ0RBQXVCO0FBQ3ZCLGdEQUE0QztBQUUvQixRQUFBLFdBQVcsR0FBRztJQUN6QixrQkFBa0IsRUFBRSxLQUFLLEVBQUUsRUFBRSxVQUFVLEVBQTBCLEVBQXFCLEVBQUU7UUFDdEYsT0FBTyxJQUFJLE9BQU8sQ0FBVyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUMvQyxNQUFNLEdBQUcsR0FBRyxtQkFBVyxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBQ3JELGNBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDaEYsSUFBSSxHQUFHO29CQUFFLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUMzQixPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUN2QixDQUFDLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELG9CQUFvQixFQUFFLEtBQUssRUFBRSxFQUFFLFVBQVUsRUFBMEIsRUFBaUIsRUFBRTtRQUNwRixJQUFJLE1BQU0sYUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQUUsT0FBTTtRQUN4RCxNQUFNLGFBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUNELFdBQVcsRUFBRSxLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFB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LG1CQUFRLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDM0YsT0FBTyxtQkFBVyxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxlQUFlLENBQUMsQ0FBQTtJQUNqRSxDQUFDO0lBQ0QsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFnQixFQUFFLFVBQXVDLEVBQUUsRUFBVSxFQUFFO1FBQ3hGLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsbUJBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNoRCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUN4QyxJQUFJLE9BQU8sQ0FBQyxhQUFhO1lBQUUsT0FBTyxRQUFRLENBQUE7UUFDMUMsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNyQyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU8sU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQy9DLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtRQUNmLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUM1QixDQUFDO0NBQ0YsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByb21pc2VzIGFzIGZzIH0gZnJvbSAnZnMnXG5pbXBvcnQgZ2xvYiBmcm9tICdnbG9iJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7IGNvbnN0YW50IH0gZnJvbSAnc3JjL3V0aWwvY29uc3RhbnQnXG5cbmV4cG9ydCBjb25zdCBmaWxlU2VydmljZSA9IHtcbiAgZmlsZUxpc3RGcm9tRm9sZGVyOiBhc3luYyAoeyBmb2xkZXJQYXRoIH06IHsgZm9sZGVyUGF0aDogc3RyaW5nIH0pOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZ1tdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBjd2QgPSBmaWxlU2VydmljZS5yZWxhdGl2ZVRvQWJzUGF0aChmb2xkZXJQYXRoKVxuICAgICAgZ2xvYignKiovKicsIHsgY3dkLCBkb3Q6IHRydWUsIG5vZGlyOiB0cnVlLCBpZ25vcmU6ICcqLnRlc3QudHMnIH0sIChlcnIsIGZpbGVzKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiByZWplY3QoZXJyKVxuICAgICAgICByZXR1cm4gcmVzb2x2ZShmaWxlcylcbiAgICAgIH0pXG4gICAgfSlcbiAgfSxcbiAgbWFrZUZvbGRlcklmTm90RXhpc3Q6IGFzeW5jICh7IGZvbGRlclBhdGggfTogeyBmb2xkZXJQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIGlmIChhd2FpdCBmcy5zdGF0KGZvbGRlclBhdGgpLmNhdGNoKCgpID0+IGZhbHNlKSkgcmV0dXJuXG4gICAgYXdhaXQgZnMubWtkaXIoZm9sZGVyUGF0aClcbiAgfSxcbiAgd3JpdGVUb0ZpbGU6IGFzeW5jICh7IGZpbGVQYXRoLCBkYXRhIH06IHsgZmlsZVBhdGg6IHN0cmluZzsgZGF0YTogc3RyaW5nIH0pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoZmlsZVBhdGgsIGRhdGEsICd1dGYtOCcpXG4gIH0sXG4gIHJlYWRGaWxlOiBhc3luYyAoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiA9PiB7XG4gICAgcmV0dXJuIGZzLnJlYWRGaWxlKGZpbGVQYXRoLCAndXRmOCcpXG4gIH0sXG4gIG1rZGlyQW5kV3JpdGVUb0ZpbGU6IGFzeW5jICh7XG4gICAgZm9sZGVyUGF0aCxcbiAgICBmaWxlTmFtZSxcbiAgICBkYXRhLFxuICB9OiB7XG4gICAgZm9sZGVyUGF0aDogc3RyaW5nXG4gICAgZmlsZU5hbWU6IHN0cmluZ1xuICAgIGRhdGE6IHN0cmluZ1xuICB9KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgYXdhaXQgZmlsZVNlcnZpY2UubWFrZUZvbGRlcklmTm90RXhpc3QoeyBmb2xkZXJQYXRoIH0pXG4gICAgYXdhaXQgZmlsZVNlcnZpY2Uud3JpdGVUb0ZpbGUoeyBmaWxlUGF0aDogZmlsZVNlcnZpY2Uuam9pblBhdGhzKGZvbGRlclBhdGgsIGZpbGVOYW1lKSwgZGF0YSB9KVxuICB9LFxuICBqb2luUGF0aHM6ICguLi5wYXRoczogc3RyaW5nW10pOiBzdHJpbmcgPT4ge1xuICAgIHJldHVybiBwYXRoLmpvaW4oLi4ucGF0aHMpXG4gIH0sXG4gIGlzQWJzUGF0aDogKHJlbGF0aXZlT3JBYnNQYXRoOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICByZXR1cm4gcmVsYXRpdmVPckFic1BhdGguc3RhcnRzV2l0aChjb25zdGFudC5mb2xkZXJTZXApXG4gIH0sXG4gIHJlbGF0aXZlVG9BYnNQYXRoOiAocmVsYXRpdmVPckFic1BhdGg6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIGZpbGVTZXJ2aWNlLmlzQWJzUGF0aChyZWxhdGl2ZU9yQWJzUGF0aCkgPyByZWxhdGl2ZU9yQWJzUGF0aCA6IGZpbGVTZXJ2aWNlLmpvaW5QYXRocyhwcm9jZXNzLmN3ZCgpLCByZWxhdGl2ZU9yQWJzUGF0aClcbiAgfSxcbiAgY2xlYW51cFBhdGg6IChyZWxhdGl2ZU9yQWJzUGF0aDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICByZXR1cm4gcGF0aC5qb2luKHJlbGF0aXZlT3JBYnNQYXRoKVxuICAgIC8vIHJldHVybiByZWxhdGl2ZU9yQWJzUGF0aC5zdGFydHNXaXRoKCcuLycpID8gcmVsYXRpdmVPckFic1BhdGguc2xpY2UoMikgOiByZWxhdGl2ZU9yQWJzUGF0aFxuICB9LFxuICBsYXN0Rm9sZGVyRnJvbVBhdGg6IChmaWxlUGF0aDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBwYXRoU3BsaXQgPSBmaWxlUGF0aC5zcGxpdChjb25zdGFudC5mb2xkZXJTZXApXG4gICAgaWYgKHBhdGhTcGxpdFtwYXRoU3BsaXQubGVuZ3RoIC0gMV0uaW5jbHVkZXMoJy4nKSkgcGF0aFNwbGl0LnBvcCgpXG4gICAgcmV0dXJuIHBhdGhTcGxpdC5qb2luKGNvbnN0YW50LmZvbGRlclNlcClcbiAgfSxcbiAgaW1wb3J0UGF0aEZpbmQ6IChmaWxlUGF0aEltcG9ydGVkRnJvbTogc3RyaW5nLCBpbXBvcnRQYXRoOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IGltcG9ydGVkRnJvbVBhdGggPSBmaWxlU2VydmljZS5sYXN0Rm9sZGVyRnJvbVBhdGgoZmlsZVBhdGhJbXBvcnRlZEZyb20pXG4gICAgY29uc3QgaW1wb3J0UGF0aFNwbGl0ID0gaW1wb3J0UGF0aC5zcGxpdChjb25zdGFudC5mb2xkZXJTZXApXG4gICAgY29uc3QgaW1wb3J0ZWRGcm9tUGF0aFJldmVyc2VTcGxpdCA9IGltcG9ydGVkRnJvbVBhdGguc3BsaXQoY29uc3RhbnQuZm9sZGVyU2VwKS5yZXZlcnNlKClcbiAgICBsZXQgZXF1YWxQYXRoU3BsaXRDb3VudCA9IDBcbiAgICBmb3IgKGNvbnN0IFtpeCwgc3BsaXRdIG9mIE9iamVjdC5lbnRyaWVzKGltcG9ydFBhdGhTcGxpdCkpIHtcbiAgICAgIGlmIChpbXBvcnRlZEZyb21QYXRoUmV2ZXJzZVNwbGl0W2l4XSAhPT0gc3BsaXQpIGJyZWFrXG4gICAgICBlcXVhbFBhdGhTcGxpdENvdW50ID0gK2l4ICsgMVxuICAgIH1cbiAgICBjb25zdCBjbGVhbkltcG9ydFBhdGggPSBpbXBvcnRQYXRoU3BsaXQuc2xpY2UoZXF1YWxQYXRoU3BsaXRDb3VudCkuam9pbihjb25zdGFudC5mb2xkZXJTZXApXG4gICAgcmV0dXJuIGZpbGVTZXJ2aWNlLmpvaW5QYXRocyhpbXBvcnRlZEZyb21QYXRoLCBjbGVhbkltcG9ydFBhdGgpXG4gIH0sXG4gIGZpbGVOYW1lRnJvbVBhdGg6IChmaWxlUGF0aDogc3RyaW5nLCBvcHRpb25zOiB7IHdpdGhFeHRlbnNpb24/OiBib29sZWFuIH0gPSB7fSk6IHN0cmluZyA9PiB7XG4gICAgY29uc3QgcGFydHMgPSBmaWxlUGF0aC5zcGxpdChjb25zdGFudC5mb2xkZXJTZXApXG4gICAgY29uc3QgbGFzdFBhcnQgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXVxuICAgIGlmIChvcHRpb25zLndpdGhFeHRlbnNpb24pIHJldHVybiBsYXN0UGFydFxuICAgIGNvbnN0IG5hbWVQYXJ0cyA9IGxhc3RQYXJ0LnNwbGl0KCcuJylcbiAgICBpZiAobmFtZVBhcnRzLmxlbmd0aCA9PT0gMSkgcmV0dXJuIG5hbWVQYXJ0c1swXVxuICAgIG5hbWVQYXJ0cy5wb3AoKVxuICAgIHJldHVybiBuYW1lUGFydHMuam9pbignLicpXG4gIH0sXG59XG4iXX0=